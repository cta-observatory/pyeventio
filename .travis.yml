language: python

env:
  secure: "bZ2ZXgn/A6tKirqOizMce+uQtzAHm/hvgschm6xDGKBzsYCZpcirZPvYhKLPuO60VHrnJL4z12V3slzObWTXePJr/DfTWO/eT/KXcSGnhtFG3T6ySbrNkb1H2mYdzRPtlIV8duZmeHk4rVIGAWGm3RWCZiJ9XoIb1sLotinrTrXERLEVhofxYwiPfRouE0qqmKFQnGd7nt1p9q3F0axdjY/qeuWaO8n809T8/JdcxMHBUf6Yf7F2iK4QFSqfQ/74vsZ/+c12xpL2XABXCkVph3t0PIJpr6EjsXvtoU0mYtL3DBlG1h0zfMyGIkIerAWT8zdf83iAoOXBTSlxyguLG/+lKbZusC//JfiTDd92kGzGFe9eR7Q+oAdd0+heueweVGXRwxX+c5JVb0YtQ0pOfpsI8NG6OaAK8HWWZDutcjZ3nPmeP5Ruuo3Ek/cH+JNqFnidPgh3RiCWsS/K9Qr5UELPzS3ublSXwUvPFzKVoQHHNP7QVZUC6nLp3jl/7n4+0e8SSGE96bBIVltKM4JMO4actouYf3AEo/B8VDRJNFo8NLNwV91igFIHIoEKjmHvOkGN6/NBcTT/afZ5bdFMT4vBOsvv7+vG7rSMAeJSQK7fOSgNJdfaoO9kmfA9TYj4XEa7jjeRCujtEhMPdPxf+kwVkkZr3s9lfB9bDdUwCwI="

matrix:
  include:
    - os: linux
      python: "3.5"
    - os: linux
      python: "3.6"
    - os: linux
      dist: xenial
      python: "3.7"
    - os: osx
      language: generic
      env: PYTHON="3.5"
    - os: osx
      language: generic
      env: PYTHON="3.6"
    - os: osx
      language: generic
      env: PYTHON="3.7"


install:
  - source .travis/install.sh
  - which pip

  - pip install zstandard docutils pygments Cython
  - pip install https://github.com/cta-observatory/pyhessio/archive/v2.1.1.tar.gz
  - pip install .

before_script:
  - pip install --upgrade pytest>=3.0.0
  - mkdir test_files
  - cd test_files
  - export TEST_FILE_DIR=`pwd -P`
  - echo $TEST_FILE_DIR
  - wget --user=$DOWNLOAD_USER --password=$DOWNLOAD_PASSWORD https://www.mpi-hd.mpg.de/personalhomes/bernlohr/cta-raw/Prod-3/data-demo2/Paranal/Sector/Gamma-clean-1/gamma_20deg_180deg_run1187___cta-prod3-demo_desert-2150m-Paranal-demo2sect_cone10.simtel-clean3.gz
  - cd ..

script:
  - python setup.py test
  - python setup.py check -r -s

deploy:
  - provider: pypi
    distributions: sdist
    skip_existing: true
    skip_cleanup: true
    user: cta-observatory
    password:
      secure: Ne3Rf08D32yP5+w96yRk/YwVIwCQLvtld7cxRxoD4mtzs5Xmc9PTIG+dVGOMzEM9auMptg0xCg/Zcs11JA/k8yLWWhqhXGi0tJ2+cA41tK0T8/It5YszW3n9zjc2hrxDClh660BGkR90nCcbWaQRrcfz9ARGJD8f11STu+7Jpr/GjLZurJPwKPmKfcHzwp8Juxp/pcUuGj8/lC/PSOXXota9fKSV0ZZfRshnyhlQmySmcVoOow0whUp7rQt5pZODd2IaNsoxIK2hG70+K5TK1VbCJuJ9bEgWGmW1WgAS7FebKYg4tcFjIDJ4RCfEgzj/0pydYdTWhwnYnkO7xT6RHtRhx4f2m2EaBKd9VMC6olzICacpXRKyFY0FX/JRj6ZrOYM/QOcZnRCY3ikuVkYo/E8RQX+hddc8IM5b7vX8jIIyS6XXT3zI7eJuP0AvGgmNjvuuv87RCd53HS6V8WuMC9gG28nlxJomIENG748gWYUBp4Jge0TbyF7iJkEo0eH27xO8Pu1PEI6iLGA9/YXdBsirfP1hZVbrXhtItQ7UUEi13cowWNsmMeGAP0EreRIH5R74y1UXnbvpKeRapXl4C/Ka7Gce95Ajytd+tFdxk2QqIpOeXu5m/L2COgaIjXu9exq0CjKnUjMpVrECVgCT4lEfa0OPTdMLcBVoBohlfA4=
    on:
      branch: master
      tags: true
      condition: $TRAVIS_PYTHON_VERSION = "3.7"
